<%- include('../partials/header.ejs') %> 
<%- include('../partials/page_header.ejs') %>
    
<style>
.product-name {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.pagination {
  margin-top: 20px;
}

.pagination a {
  color: #333;
  padding: 5px 10px;
  text-decoration: none;
  border: 1px solid #ddd;
  margin-right: 5px;
}

.pagination a .active {
  background-color: #333;
  color: #fff;
}
</style>

<main class="main">
  <!-- Breadcrumbs -->
  <div class="page-header breadcrumb-wrap" style="padding: 5px">
    <div class="container">
      <div class="breadcrumb">
          <a href="/" rel="unfollow">Home</a>
          <span><a href="/shop">Shop</a> </span>
      </div>
    </div>
  </div>

  <!-- product lists -->
  <section class="mt-50 mb-50">
    <div class="container">
      <div class="row flex-row-reverse">
        <div class="col-lg-9">
            <!-- sorting top bar -->
          <div class="shop-product-fillter">
            <!-- We found dash products section -->
            <div class="totall-product" style="visibility: hidden;">
              <p>
                We found
                <strong class="text-brand"><%= products.length %></strong> items
                for you!
              </p>
            </div>
            <!-- Sorting Dropdown menu -->
            <div class="sort-by-product-area">
              <div class="sort-by-cover">
                <div class="sort-by-product-wrap">
                  <div class="sort-by">
                    <span><i class="fi-rs-apps-sort"></i></span>
                  </div>
                  <div class="sort-by-dropdown-wrap">
                    <select id="sortDropdown" class="form-control">
                      <option value="">Sort by</option>
                      <option value="price-asc">Price: Low to High</option>
                      <option value="price-desc">Price: High to Low</option>
                      <option value="name-asc">Name: A to Z</option>
                      <option value="name-desc">Name: Z to A</option>
                    </select>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <!-- products populations -->
          <div class="row product-grid-3">
            <% for(let i = 0; i < products.length; i++) { %>
            <div class="col-lg-4 col-md-4 col-12 col-sm-6">
              <div class="product-cart-wrap mb-30">
                <div class="product-img-action-wrap">
                  <div class="product-img product-img-zoom">
                    <a href="/load_product?id=<%= products[i]._id %>">
                      <img class="default-img" src="/uploads/<%= products[i].media[0] %>" alt="" />
                      <img class="hover-img" src="/uploads/<%= products[i].media[0] %>" alt="" />
                    </a>
                  </div>
                </div>
                <div class="product-content-wrap">
                  <div class="product-category">
                    <a href="shop-grid-right.html"><%= products[i].category %></a>
                  </div>
                  <h2 class="product-name">
                    <a href="shop-product-right.html"><%= products[i].name %></a>
                  </h2>
                  <div class="rating-result" title="90%">
                    <span><span>90%</span></span>
                  </div>
                  <div class="product-price" style="font-family: sans-serif;">
                    <% if (products[i].offerPrice != 0 || products[i].categoryDiscountPrice != 0) { %>
                      <% if (products[i].offerPrice < products[i].categoryDiscountPrice && products[i].offerPrice != 0) { %>
                          <span>$<%= products[i].offerPrice %></span>
                          <span class="old-price">$<%= products[i].price %></span>
                      <% } else { %>
                          <span>$<%= products[i].categoryDiscountPrice %></span>
                          <span class="old-price">$<%= products[i].price %></span>
                      <% } %>
                    <% } else { %>
                      <span>$<%= products[i].price %></span>
                    <% } %>
                  </div>
                  <form action="/"></form>
                  <div class="product-action-1 show">
                    <a
                      aria-label="Add To Cart"
                      class="action-btn hover-up"
                      <% if (user) { %>
                        onclick="addToCart('<%= products[i]._id %>')"
                      <% } else { %>
                        onclick="goHome()"
                      <% } %>>
                      <i class="fi-rs-shopping-bag-add"></i>
                    </a>
                    <a
                      aria-label="Add To Wishlist"
                      class="action-btn hover-up" 
                      <% if (user) { %>
                        onclick="addToWishlist('<%= products[i]._id %>')"
                      <% } else { %>
                        onclick="goHome()"
                      <% } %>>
                      <i class="fi-rs-heart"></i>
                    </a>
                  </div>
                </div>
              </div>
            </div>
            <% } %>
          </div>

          <!-- Pagination Controls -->
          <div class="pagination" style="justify-content: center;">
            <% if (currentPage > 1) { %>
              <a href="?page=<%= currentPage - 1 %>">Previous</a>
            <% } %>

            <% for (let i = 1; i <= totalPages; i++) { %>
              <% if (i === currentPage) { %>
                <a href="?page=<%= i %>" style="background-color: #333; color: #ddd;"><%= i %></a>
              <% } else { %>
                <a href="?page=<%= i %>"><%= i %></a>
              <% } %>
            <% } %>

            <% if (currentPage < totalPages) { %>
              <a href="?page=<%= currentPage + 1 %>">Next</a>
            <% } %>
          </div>

        </div>
        <!-- left filters -->
        <div class="col-lg-3 primary-sidebar sticky-sidebar">
          <div class="widget-category mb-30">
            <h5 class="section-title style-1 mb-30 wow fadeIn animated">Category</h5>
            <ul class="categories">
              <li><a>Show all</a></li>
              <% categories.forEach((Category) => { %>
                <li><a><%= Category.name %></a></li>
              <% }); %>
            </ul>
          </div>
          <!-- Product sidebar Widget -->
          <div class="sidebar-widget product-sidebar mb-30 p-30 bg-grey border-radius-10">
            <div class="widget-header position-relative mb-20 pb-10">
              <h5 class="widget-title mb-10">New products</h5>
              <div class="bt-1 border-color-1"></div>
            </div>
            <% for(let i = 0; i < Math.min(3, products.length); i++) { %>
              <div class="single-post clearfix">
                <div class="image">
                  <img src="/uploads/<%= products[i].media[0] %>" alt="#" />
                </div>
                <div class="content pt-10">
                  <h5><a href="/load_product?id=<%= products[i]._id %>"> <%= products[i].name %></a></h5>
                  <p class="price mb-0 mt-5">$ <%= products[i].price %></p>
                </div>
              </div>
            <% } %>
          </div>
        </div>
      </div>
    </div>
  </section>
</main>

<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>

<%- include('../partials/page_footer.ejs') %> 
<%- include('../partials/footer.ejs')%>
